{"version":3,"sources":["../../../src/public/js/chat.js"],"names":["chatVM","enterMsg","ko","observable","chatButtonEnable","sendMsg","length","socket","emit","chatMsg","chatArray","shift","push","chatUser","baseVM","userName","chatTime","moment","Date","format","chat","scrollToBottom","setTimeout","chatFadeIn","element","index","data","$","hide","fadeIn","observableArray","onlineUsersArray","_chat","applyBindings","document","getElementById","getChats","receiveChats","WebSocket","io","connect","transports","prototype","on","result","each","i","unshift","container","animate","scrollTop","height"],"mappings":"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","file":"chat.js","sourcesContent":["ï»¿var chatVM = {\r\n    enterMsg: ko.observable(''),\r\n    chatButtonEnable: ko.observable(1),\r\n    sendMsg: function () {\r\n        if (this.enterMsg().length > 0) {\r\n            socket.emit('sendChat', {chatMsg: this.enterMsg() });\r\n            if (chatArray().length > 100)\r\n                chatArray.shift();\r\n            chatArray.push({ chatUser: baseVM.userName() , chatTime: moment(new Date()).format('YYYY-MM-DD HH:mm'), chatMsg: this.enterMsg() });\r\n            this.chatButtonEnable(0);\r\n            this.enterMsg('');\r\n            chat.scrollToBottom();\r\n            //Pause 5 seconds to enter next message\r\n            setTimeout(function () { chatVM.chatButtonEnable(1); }, 1000 * 5);\r\n        }\r\n    },\r\n    chatFadeIn: function (element, index, data) {\r\n        //add fadein effect when new chat comes in\r\n        $(element).hide();\r\n        $(element).fadeIn(500);\r\n    }\r\n};\r\nvar chatArray = ko.observableArray(),\r\n    onlineUsersArray = ko.observableArray();\r\n\r\n$(function () {\r\n    \r\n    var _chat = new chat(socket);\r\n    ko.applyBindings(chatVM, document.getElementById(\"chatBox\"));\r\n    _chat.getChats();\r\n    _chat.receiveChats();\r\n});\r\n\r\nvar chat = function (socket) {\r\n    this.socket = socket;\r\n\r\n    if (!this.socket) { \r\n        if (typeof (WebSocket) != \"function\") {\r\n            this.socket = io();\r\n            }\r\n            else {\r\n                /* Use websocket only */\r\n                this.socket = io.connect({ transports: ['websocket'] });\r\n            }\r\n    }\r\n}\r\n\r\n//Get last chats from server\r\nchat.prototype.getChats = function () {\r\n    this.socket.emit('getChats', '');\r\n    this.socket.on('getChats', function (result) {\r\n        if (result.length > 0) {\r\n            $(result).each(function (i) {\r\n                chatArray.unshift({ chatUser: result[i].chatUser, chatTime: moment(result[i].chatTime).format('YYYY-MM-DD HH:mm'), chatMsg: result[i].chatMsg });\r\n            })\r\n        }\r\n        chat.scrollToBottom();\r\n    });\r\n}\r\n\r\n//Receive chats after loading\r\nchat.prototype.receiveChats = function () { \r\n    this.socket.on('recvChat', function (result) {\r\n        if (chatArray().length > 100)\r\n            chatArray.shift();\r\n        chatArray.push({ chatUser: result.chatUser, chatTime: moment(result.chatTime).format('YYYY-MM-DD HH:mm'), chatMsg: result.chatMsg });\r\n        chat.scrollToBottom();\r\n    });\r\n}\r\n\r\n\r\nchat.scrollToBottom = function () {\r\n    var container = $('#chatList')\r\n    container.animate({ scrollTop: container.height() + 20000 }, 1000);\r\n}"]}